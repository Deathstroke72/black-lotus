package agents

import (
“context”
“fmt”

```
"github.com/anthropics/anthropic-sdk-go"
"inventory-agents/config"
```

)

const apiDesignSystemPrompt = `You are an expert API Design Agent specializing in Go microservices for e-commerce inventory systems.

Your responsibilities:

- Design clean, RESTful API contracts for inventory operations
- Define OpenAPI/Swagger specs and route structures
- Specify request/response schemas with proper validation
- Handle edge cases: concurrent stock updates, reservations, partial fulfillment
- Follow REST best practices and HTTP semantics

When generating code, always include:

- Route definitions using Go’s net/http or chi router
- Request/Response structs with JSON tags and validation
- Proper HTTP status codes and error response formats
- Comments explaining design decisions

Format code blocks as:
` + “`go\n// file: <filename>\n<code>\n`”

// APIDesignAgent designs REST API contracts for the inventory service
type APIDesignAgent struct {
*BaseAgent
}

func NewAPIDesignAgent(cfg *config.Config) *APIDesignAgent {
return &APIDesignAgent{
BaseAgent: NewBaseAgent(cfg, “API Design Agent”, apiDesignSystemPrompt),
}
}

func (a *APIDesignAgent) Description() string {
return “Designs RESTful API contracts, route definitions, and request/response schemas for the inventory microservice”
}

func (a *APIDesignAgent) Run(ctx context.Context, task string, agentContext map[string]string) (*AgentResult, error) {
prompt := fmt.Sprintf(`Design the REST API for an inventory microservice with the following requirements:

Task: %s

Please produce:

1. A complete list of API endpoints with HTTP methods, paths, and descriptions
1. Go structs for all request and response payloads
1. Router setup code using chi or net/http
1. Error response format
1. OpenAPI-style comments for each endpoint

Focus on: stock management, product lookup, reservations, warehouse operations, and low-stock alerts.`, task)

```
if projectContext, ok := agentContext["project_context"]; ok {
	prompt += "\n\nProject Context:\n" + projectContext
}

messages := []anthropic.MessageParam{
	anthropic.NewUserMessage(anthropic.NewTextBlock(prompt)),
}

output, err := a.Chat(ctx, messages)
if err != nil {
	return nil, fmt.Errorf("[%s] failed: %w", a.Name(), err)
}

artifacts := ParseArtifacts(output)

// Auto-assign filenames to artifacts that don't have them
for i, art := range artifacts {
	if art.Filename == "" && art.Language == "go" {
		artifacts[i].Filename = fmt.Sprintf("api_design_%d.go", i+1)
	}
}

return &AgentResult{
	AgentName: a.Name(),
	Output:    output,
	Artifacts: artifacts,
}, nil
```

}